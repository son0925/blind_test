<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Quiz</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .quiz-container { margin-top: 20px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .question {
            display: block;
            max-width: 95%;
            margin: 0 auto;
            padding: 15px;
            font-size: 20px;
            word-wrap: break-word;
            white-space: normal;
            line-height: 1.6;
        }

        .quiz-image {
            max-width: 90%;
            max-height: 400px; /* ì´ ë¶€ë¶„ ì¶”ê°€ ë˜ëŠ” ìˆ˜ì • */
            margin: 15px auto;
            display: none;
            object-fit: contain; /* ì´ë¯¸ì§€ ë¹„ìœ¨ ìœ ì§€í•˜ë©° ê½‰ ì°¨ê²Œ */
        }
        .answer {
            display: none;
            font-weight: bold;
            color: blue;
        }
        .nav-btn {
            margin: 10px;
            padding: 5px 15px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<h1>í€´ì¦ˆ</h1>
<div class="quiz-container">
    <h2 th:text="${test.name}"></h2>

    <div id="quiz-section">
        <p class="question"><span id="question"></span></p>
        <img id="quiz-image" class="quiz-image" src="" alt="ë¬¸ì œ ì´ë¯¸ì§€">
        <p><span id="answer" class="answer"></span></p>
        <button id="toggle-answer-btn">ì •ë‹µ í™•ì¸</button>
    </div>

    <button class="nav-btn" onclick="prevQuestion()">â¬…ï¸ ì´ì „</button>
    <button class="nav-btn" onclick="nextQuestion()">ë‹¤ìŒ â¡ï¸</button>
</div>

<a href="/category">í™ˆìœ¼ë¡œ</a>

<script th:inline="javascript">
    let quizzes;

    try {
        quizzes = [[${test.testEntityList}]];
        if (typeof quizzes === "string") {
            quizzes = JSON.parse(quizzes);
        }
        console.log("âœ… í€´ì¦ˆ ë°ì´í„° í™•ì¸ (ì›ë³¸):", quizzes);
    } catch (error) {
        console.error("âŒ ì˜¤ë¥˜ ë°œìƒ: quizzes ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ.", error);
        quizzes = [];
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            let j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    if (quizzes.length > 0) {
        shuffleArray(quizzes);
        console.log("ğŸ”€ í€´ì¦ˆ ë°ì´í„° ì…”í”Œ ì™„ë£Œ:", quizzes);
    }

    let currentIndex = 0;

    function displayQuestion() {
        if (!quizzes || quizzes.length === 0) {
            console.warn("âš ï¸ í€´ì¦ˆ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            document.getElementById("question").innerText = "í€´ì¦ˆê°€ ì—†ìŠµë‹ˆë‹¤.";
            document.getElementById("answer").innerText = "";
            document.getElementById("quiz-image").style.display = "none";
            return;
        }

        let quiz = quizzes[currentIndex];

        if (quiz) {
            console.log("ğŸ“Œ í˜„ì¬ ë¬¸ì œ:", quiz);
            document.getElementById("question").innerText = quiz.question;
            document.getElementById("answer").innerText = quiz.answer;
            document.getElementById("answer").style.display = "none";

            // ì´ë¯¸ì§€ ì²˜ë¦¬
            const imageEl = document.getElementById("quiz-image");
            if (quiz.imageUrl && quiz.imageUrl.trim() !== "") {
                imageEl.src = quiz.imageUrl;
                imageEl.style.display = "block";
            } else {
                imageEl.style.display = "none";
            }
        }
    }

    function prevQuestion() {
        if (currentIndex > 0) {
            currentIndex--;
            displayQuestion();
        }
    }

    function nextQuestion() {
        if (currentIndex < quizzes.length - 1) {
            currentIndex++;
            displayQuestion();
        }
    }

    document.getElementById("toggle-answer-btn").addEventListener("click", function () {
        let answerEl = document.getElementById("answer");
        answerEl.style.display = (answerEl.style.display === "none") ? "inline" : "none";
    });

    document.addEventListener("DOMContentLoaded", function () {
        displayQuestion();
    });
</script>

</body>
</html>
