<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Quiz</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .quiz-container { margin-top: 20px; }
        .answer { display: none; font-weight: bold; color: blue; }
        .nav-btn { margin: 10px; padding: 5px 15px; cursor: pointer; }
    </style>
</head>
<body>

<h1>í€´ì¦ˆ</h1>
<div class="quiz-container">
    <h2 th:text="${test.name}"></h2>

    <div id="quiz-section">
        <p><strong>ì§ˆë¬¸:</strong> <span id="question"></span></p>
        <p>
            <strong>ë‹µë³€:</strong>
            <span id="answer" class="answer"></span>
        </p>
        <button id="toggle-answer-btn">ì •ë‹µ í™•ì¸</button>
    </div>

    <button class="nav-btn" onclick="prevQuestion()">â¬…ï¸ ì´ì „</button>
    <button class="nav-btn" onclick="nextQuestion()">ë‹¤ìŒ â¡ï¸</button>
</div>

<a href="/category">í™ˆìœ¼ë¡œ</a>

<script th:inline="javascript">
    let quizzes;

    try {
        quizzes = [[${test.testEntityList}]];
        if (typeof quizzes === "string") {
            quizzes = JSON.parse(quizzes);
        }
        console.log("âœ… í€´ì¦ˆ ë°ì´í„° í™•ì¸ (ì›ë³¸):", quizzes);
    } catch (error) {
        console.error("âŒ ì˜¤ë¥˜ ë°œìƒ: quizzes ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ.", error);
        quizzes = [];
    }

    // ëœë¤ ì…”í”Œ í•¨ìˆ˜ (Fisher-Yates ì•Œê³ ë¦¬ì¦˜)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            let j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // í€´ì¦ˆ ì„ê¸°
    if (quizzes.length > 0) {
        shuffleArray(quizzes);
        console.log("ğŸ”€ í€´ì¦ˆ ë°ì´í„° ì…”í”Œ ì™„ë£Œ:", quizzes);
    }

    let currentIndex = 0;

    function displayQuestion() {
        if (!quizzes || quizzes.length === 0) {
            console.warn("âš ï¸ í€´ì¦ˆ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            document.getElementById("question").innerText = "í€´ì¦ˆê°€ ì—†ìŠµë‹ˆë‹¤.";
            document.getElementById("answer").innerText = "";
            return;
        }

        let quiz = quizzes[currentIndex];

        if (quiz) {
            console.log("ğŸ“Œ í˜„ì¬ ë¬¸ì œ:", quiz);
            document.getElementById("question").innerText = quiz.question;
            document.getElementById("answer").innerText = quiz.answer;
            document.getElementById("answer").style.display = "none"; // í˜ì´ì§€ ì´ë™ ì‹œ ì •ë‹µ ìˆ¨ê¸°ê¸°
        }
    }

    function prevQuestion() {
        if (currentIndex > 0) {
            currentIndex--;
            displayQuestion();
        }
    }

    function nextQuestion() {
        if (currentIndex < quizzes.length - 1) {
            currentIndex++;
            displayQuestion();
        }
    }

    // ì •ë‹µ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    document.getElementById("toggle-answer-btn").addEventListener("click", function () {
        let answerEl = document.getElementById("answer");
        if (answerEl.style.display === "none") {
            answerEl.style.display = "inline"; // ì •ë‹µ í‘œì‹œ
        } else {
            answerEl.style.display = "none"; // ì •ë‹µ ìˆ¨ê¸°ê¸°
        }
    });

    document.addEventListener("DOMContentLoaded", function () {
        displayQuestion();
    });
</script>

</body>
</html>
